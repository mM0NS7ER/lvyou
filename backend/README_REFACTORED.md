
# Law Agent API - 重构版本

## 项目结构

本项目遵循单一职责原则(SRP)进行了重构，将代码分为以下几个主要模块：

### 1. 配置模块 (config)
- `db_config.py`: 负责数据库连接和配置

### 2. 数据访问模块 (repositories)
- `chat_repository.py`: 负责与聊天消息相关的数据库操作

### 3. 服务模块 (services)
- `chat_service.py`: 负责处理聊天相关的业务逻辑
- `ai_service.py`: 负责生成AI响应

### 4. 模型模块 (models)
- `chat.py`: 包含请求和响应的数据模型

### 5. 路由模块 (routers)
- `chat.py`: 聊天相关的API路由
- `health.py`: 健康检查API路由

## 单一职责原则应用

重构后的代码遵循了单一职责原则，每个模块和类都有明确的职责：

1. **配置模块**：只负责数据库连接和配置管理
2. **数据访问模块**：只负责数据库操作，不包含业务逻辑
3. **服务模块**：只负责业务逻辑处理，不直接操作数据库
4. **模型模块**：只负责数据定义和验证
5. **路由模块**：只负责API路由和请求处理

这种架构使得代码更易于维护、测试和扩展。

## 启动应用

```bash
cd backend
pip install -r requirements.txt
python main.py
```

## 数据库连接

应用启动时会自动连接到MongoDB数据库，关闭时会自动断开连接。数据库连接配置通过环境变量`MONGODB_URI`设置，默认值为`mongodb://localhost:27017/`。

## 扩展性

这种架构使得添加新功能变得更加容易：

1. 添加新的数据模型：在`models`目录下添加新的模型类
2. 添加新的数据库操作：在`repositories`目录下添加新的仓储类
3. 添加新的业务逻辑：在`services`目录下添加新的服务类
4. 添加新的API路由：在`routers`目录下添加新的路由文件

## 测试

每个模块都可以独立测试，因为它们之间通过依赖注入进行交互，而不是紧耦合。
